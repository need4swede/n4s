<!DOCTYPE html>
<html lang="en">

<head>
    <title>podRacer - Functionality</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="podRacer Documentation">
    <meta name="author" content="Mike Afshari">    
    <link rel="shortcut icon" href="favicon.ico">  
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!-- FontAwesome JS -->
    <script defer src="assets/fontawesome/js/all.js"></script>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">   
    <!-- Plugins CSS -->    
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <link rel="stylesheet" href="assets/plugins/lightbox/dist/ekko-lightbox.css">
    <link rel="stylesheet" href="assets/plugins/elegant_font/css/style.css">

    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles-dark.css">
    
</head> 

<body class="body-blue">

    <div class="page-wrapper">
        <!-- ******Header****** -->
        <header id="header" class="header">
            <div class="container">
                <div class="branding">
                    <h1 class="logo">
                        <a href="index.html">
                            <span class="text-bold">n</span><span class="token classname-blue">eed</span><span class="text-bold">4s</span><span class="token function">wede</span>
                        </a>
                    </h1>
                </div>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item active">Functionality</li>
                </ol>
            </div>
        </header>

        <div class="doc-wrapper">
            <div class="container">

                <div class="doc-body row">

                    <div class="doc-content col-md-9 col-12 order-1">

                        <div class="content-inner">

                            <section id="foundation" class="doc-section">
                                <h2 class="section-title">Foundation</h2>
                                <div class="section-block">
                                    <h3 class="block-title">What it does</h3>
                                    <p>
                                        <strong>N4S</strong> is a feature rich Python package that makes writing pythonic code easier and more intuative
                                        using libraries that already come packaged with Python 3.
                                    </p>
                                    <p>There are currently four core modules:</p>
                                    <ul><code class="language python">
                                        <li><strong class="token classname">fs</strong> - <span class="token string">interacts with your file system</span></li>
                                        <li><strong class="token classname">strgs</strong> - <span class="token string">manipulates strings and lists</span></li>
                                        <li><strong class="token classname">term</strong> - <span class="token string">console / terminal commands</span></li>
                                        <li><strong class="token classname">web</strong> - <span class="token string">series of web oriented tools</span></li>
                                    </ul></code>
                                    <p>
                                        <strong><a class="scrollto" href="#fetch-calls">Process</a></strong>, <strong><a class="scrollto" href="#metadata">Organize</a></strong> and <strong><a class="scrollto" href="#downloads">Download</a></strong> &mdash; that's what <strong>podRacer</strong> is designed to do.
                                    </p>
                                </div>
                                <div class="section-block">
                                    <h3 class="block-title">How it works</h3>
                                    <p>
                                        <strong>podRacer</strong> is a multi-threaded application, which means it has room in the back for a car seat to take the kids to school on its way to work.
                                        Tasks, such as fetch calls and downloads, are handled by separate thread workers to not only ensure the stability of the application in the event of network discrepancies,
                                        but also allows each worker to be individually optimized by the application and the respective OS.
                                    </p>
                                    <p>
                                        By using <em>QRunnable</em> and <em>WorkerSignals</em>, <strong>podRacer</strong> is able to designate a background task
                                        and communicate with it from the main application. This keeps the main application free to take on more work from
                                        the user. Here's how it does it:
                                    </p>
                                    <!-- PYTHON: DOWNLOAD WORKER -->
                                    <h5>Python</h5>
                                    <p>
                                        <pre><code class="language-python">
from <span class="token classname">PyQt6.QtCore</span> import <span class="token classname">QRunnable, </span><span class="token function">pyqtSlot</span>
...

<span class="token classname-blue">class</span> <span class="token classname">Worker</span>(QRunnable):
    <span class="token classname-blue">def</span> __init__(self, fn, *args, **kwargs):
        super(Worker, self).<span class="token function">__init__</span>()

        # The passed in function
        self.fn = fn
        
        # The passed in arguments
        self.args = args

        # Keyword arguments
        self.kwargs = kwargs

        # Create the worker signals to communicate task progress
        self.signals = WorkerSignals()
        ...

    # The thread's worker function
    <span class="token function">@pyqtSlot()</span>
    <span class="token classname-blue">def</span> run(self): 

        # Runs the passed in function, with its arguments
        result = self.fn(*self.args, **self.kwargs)

        # Returns the results of the thread
        self.signals.result.<span class="token function">emit</span>(result)
        
        # Signal that the thread has completed its task
        self.signals.finished.<span class="token function">emit</span>()  
<p></p>
                                        </code></pre>
                                    </p>
                                    <p>
                                        You can also use a threadpool and create separate thread classes to handle designated workloads
                                        <small><br>
                                            <strong>Note:</strong> I wrote this just an example - if you're using this for your own application, please adapt it accordingly!
                                        </small>
                                    </p>
                                    <!-- PYTHON: DOWNLOAD POOL -->
                                    <h5>Python</h5>
                                    <p>
                                        <pre><code class="language-python">
from <span class="token classname">PyQt6.QtCore</span> import <span class="token classname">QThreadPool</span>                                         
import <span class="token classname">multiprocessing</span>
...

<span class="token classname-blue">class</span> <span class="token classname">MainWindow</span>(QMainWindow):
    <span class="token classname-blue">def</span> __init__(self, *args, **kwargs):
        super(MainWindow, self).<span class="token function">__init__</span>(*args, **kwargs)                
        self.threadpool = QThreadPool()                                  
        ...
        self.<span class="token function">thread</span>={}
        self.<span class="token keyword">button</span>.<span class="token function">clicked</span>.<span class="token function">connect</span>(<span class="token classname-blue">lambda</span>: self.<span class="token function">start_worker</span>(1))
    
    <span class="token classname-blue">def</span> threadRunner(self):

        # Create our thread and give it a function as the argument
        self.<span class="token keyword">worker</span> = <span class="token classname">Worker</span>(self.<span class="token function">some_function</span>)

        # Connect result signal of our thread to thread_result
        self.<span class="token keyword">worker</span>.signals.result.<span class="token function">connect</span>(self.<span class="token function">thread_result</span>)

        # Connect finish signal of our thread to thread_complete
        self.<span class="token keyword">worker</span>.signals.finished.<span class="token function">connect</span>(self.<span class="token function">thread_finished</span>)
        
        # Initialize multiprocessing
        self.<span class="token keyword">proc</span> = <span class="token classname">multiprocessing.Process</span>(<span class="token keyword">target</span>=self.threadpool.<span class="token function">start</span>(self.<span class="token keyword">worker</span>), args=())
        
        # Run process
        self.<span class="token keyword">proc</span>.<span class="token function">start</span>()

    # Star Worker
    <span class="token classname-blue">def</span> start_worker(self, i):
    
        # Start Thread
        self.<span class="token function">thread</span>[i] = ThreadClass(parent=None,index=1)
        self.<span class="token function">thread</span>[i].<span class="token function">start</span>()
    
        # Connect Signal
        self.<span class="token function">thread</span>[i].any_signal.<span class="token function">connect</span>(self.<span class="token function">background_task</span>)

    <span class="token classname-blue">def</span> background_task(self):
        index = self.<span class="token function">sender</span>().index
        if index==1:
            # DO SOMETHING
        if index==2: 
            # DO SOMETHING ELSE
        if index==3:
            # DO SOMETHING ELSE

    <span class="token classname-blue">def</span> thread_result(self):
        # Signal Results

    <span class="token classname-blue">def</span> thread_finished(self):
        # Signal Completion of Task

    <span class="token classname-blue">def</span> stop_worker(self, i):
        self.<span class="token function">thread</span>[i].<span class="token function">stop</span>()

if <span class="token keyword">__name__</span> == '__main__':

    # Necessary for excecutables
    <span class="token classname">multiprocessing</span>.<span class="token function">freeze_support</span>()
<p></p>
                                        </code></pre>
                                    </p>
                                </div>
                            </section>
                            
                            <section id="fetch-calls" class="doc-section">
                                <h2 class="section-title">Fetch Calls</h2>
                                <div class="section-block">
                                    <h3 class="block-title">What it does</h3>
                                    <p>Sends a request to read certain properties of an RSS feed in XML / HTML format</p>
                                    <p>Read more about it here: <a href="start.html#fetch-section" target="_blank">Starter Guide - Fetch Calls</a></p>
                                </div>
                                <div class="section-block">
                                    <h3 class="block-title">How it works</h3>
                                    <p>With each fetch call, podRacer tests your network connection to ensure reliable transmissions.</p>
                                    <!-- NETWORK TEST -->
                                    <p>
<pre><code class="language-python"><span class="token keyword">network_test</span> = <span class="token classname">httplib.HTTPSConnection</span>("8.8.8.8", <span class="token keyword">timeout</span>=5)
    try:
    <span class="token keyword">network_test</span><span class="token classname">.request</span>("HEAD", "/")
    return True # A valid network connection has been established
...</code></pre>
                                    </p>
                                    <p>
                                        During downloads, a background task monitors your system's performance and dynamically 
                                        adjusts resource management, including CPU usage and network bandwidth. If your download speed
                                        is slow, or if your CPU is under-performing, <strong>podRacer</strong> will adequately scale back its download thread
                                        worker to accomodate. While this may result in a slower download, it ensures other processes aren't
                                        effected.
                                    </p>
                                    <!-- CPU LIMITER -->
                                    <p>
<pre><code class="language-python">
<span class="token classname-blue">def</span> performance_limiter():
    <span class="token keyword">p</span> = <span class="token classname">psutil.Process</span>(<span class="token classname">os</span>.<span class="token function">getpid</span>())
    <span class="token keyword">p</span>.<span class="token function">nice</span>(<span class="token classname">psutil</span>.BELOW_NORMAL_PRIORITY_CLASS) # If Unix: ps.nice(19)
</code></pre>
                                    </p>
                                    <p>
                                        Once the fetch request is received, <strong>podRacer</strong> will parse the XML data for key information.
                                        The 'Show Metadata' is passed into the user interface, which
                                        then displays this information to the user. Each 'item' referring to an episode is counted
                                        to deliver the total episode count.
                                    </p>
                                    <!-- XML: DATA -->
                                    <h5>XML</h5>
                                    <p id="xml">
                                        <pre><code class="language-markup">
<span class="token comment">// SHOW METADATA</span>
&#x3C;title&#x3E;The Daily&#x3C;/title&#x3E;
&#x3C;description&#x3E;This is what the news should sound like...&#x3C;/description>
&#x3C;language>en&#x3C;/language>
&#x3C;pubDate>Mon, 13 Jun 2022 10:00:00 +0000&#x3C;/pubDate>
&#x3C;lastBuildDate>Mon, 13 Jun 2022 10:00:23 +0000&#x3C;/lastBuildDate>
&#x3C;itunes:author>The New York Times&#x3C;/itunes:author>

...

<span class="token comment">// EPISODE METADATA</span>
&#x3C;item>
    &#x3C;title>The Incomplete Picture of the War in Ukraine&#x3C;/title>
    &#x3C;description>In the nearly four months since the Russian invasion of Ukraine...&#x3C;/description>
    &#x3C;pubDate>Mon, 13 Jun 2022 10:00:00 +0000&#x3C;/pubDate>
    &#x3C;enclosure length="21322381" type="audio/mpeg" url="https://dts.podtrac.com/redirect.mp3/chrt.fm/track/8DB4DB/pdst.fm/e/nyt.simplecastaudio.com/03d8b493-87fc-4bd1-931f-8a8e9b945d8a/episodes/8f932970-ceda-4af8-83df-b022ed3ad0be/audio/128/default.mp3?aid=rss_feed&awCollectionId=03d8b493-87fc-4bd1-931f-8a8e9b945d8a&awEpisodeId=8f932970-ceda-4af8-83df-b022ed3ad0be&feed=54nAGcIl"/>
    &#x3C;itunes:author>The New York Times&#x3C;/itunes:author>
    &#x3C;itunes:duration>00:22:12&#x3C;/itunes:duration>
&#x3C;/item>
                                        </code></pre>
                                    </p>
                                    <!-- PYTHON: GET METADATA -->
                                    <h5>Python</h5>
                                    <p id="getmetadata">
                                        <pre><code class="language-python">
# No. of Episodes
<span class="token keyword">episode_count</span> = 0

# Array of RSS Elements
<span class="token keyword">items</span> = <span class="token keyword">rss_data</span>.<span class="token function">findAll</span>('item')

# Get Show Title
<span class="token keyword">show_title</span> = <span class="token keyword">rss_data</span>.<span class="token function">find</span>('title').<span class="token function">text</span>

# Get Show Author
<span class="token keyword">show_author</span> = <span class="token keyword">rss_data</span>.<span class="token function">find</span>('itunes:author').<span class="token function">text</span>

# Get Latest Episode
<span class="token keyword">latest_ep_date</span> = <span class="token keyword">rss_data</span>.<span class="token function">find</span>('pubdate').<span class="token function">text</span>

# Get Episode Data
<span class="token loop">for</span> <span class="token keyword">item</span> <span class="token loop">in</span> <span class="token keyword">items</span>:

    # Create Dict
    <span class="token keyword">rss_item</span> = {}

    # Collect Title, Description and Publish Date
    <span class="token keyword">rss_item</span>['title'] = <span class="token keyword">item</span>.title.<span class="token function">get_text</span>(<span class="token function">strip</span>=False)
    <span class="token  keyword">rss_item</span>['description'] = <span class="token keyword">item</span>.description.<span class="token function">text</span>
    <span class="token  keyword">rss_item</span>['pubdate'] = <span class="token keyword">item</span>.pubdate.<span class="token function">text</span>.<span class="token function">split</span>(',')[1]

# Accumulate Episode Count
<span class="token keyword">episode_count</span> = <span class="token function">len</span>(<span class="token keyword">items</span>)
                                        </code></pre>
                                    </p>
                                    <p>Update the interface with the show metadata</p>
                                    <!-- PYTHON: GET METADATA -->
                                    <h5>Qt (PyQt6)</h5>
                                    <p>
                                        <pre><code class="language-python">
# QLabels...
self.<span class="token keyword">title</span> = QLabel('Title')
self.<span class="token keyword">author</span> = QLabel('Author')
self.<span class="token keyword">last_updated</span> = QLabel('Last Updated:')
self.<span class="token keyword">length</span> = QLabel('Episode Count:')

...

# Update QLabel Text...
self.<span class="token keyword">title.</span><span class="token function">setText</span>(<span class="token keyword">show_title</span>)
self.<span class="token keyword">author.</span><span class="token function">setText</span>(<span class="token keyword">show_author</span>)
self.<span class="token keyword">last_updated.</span><span class="token function">setText</span>("Last Updated: ", <span class="token keyword">latest_ep_date</span>)
self.<span class="token keyword">length.</span><span class="token function">setText</span>("Episode Count: ", <span class="token keyword">episode_count</span>)
                                        </code></pre>
                                    </p>
                                </div>
                            </section>
                            
                            <section id="metadata" class="doc-section">
                                <h2 class="section-title">Metadata &amp; Reporting</h2>
                                <div class="section-block">
                                    <h3 class="block-title">What it does</h3>
                                    <p>
                                        Using the XML data from a fetch request, <strong>podRacer</strong> is able to automatically generate
                                        comprehensive reports of podcasts, conveniently gathering metadata from each individual episode and creating
                                        an interactive webpage that can be easily hosted and shared.
                                    </p>
                                    <p>You can view a sample report here: <a href="https://www.podracer.app/assets/sample-metadata.html" target="_blank">podRacer - Sample Metadata</a></p>
                                </div>
                                <div class="section-block">
                                    <h3 class="block-title">How it works</h3>
                                    <p>
                                        A dataframe is created using the XML data, along with HTML, CSS, Javascript files to give the report
                                        some style and functionality. By default, metadata reports have dark-mode enabled, with 'click-to-copy' functionality
                                        built-in. 
                                    </p>
                                    <p>
                                        Here is an example of how one might generate one of these reports using HTML, CSS and Javascript
                                    </p>
                                    <!-- PYTHON: GET METADATA -->
                                    <h5>Python</h5>
                                    <p>
                                        <pre><code class="language-python">
import pandas as pd
...

<span class="token keyword">rss</span> = pd.DataFrame(<span class="token keyword">rss_items</span>, <span class="token keyword">columns</span>=[...])
...

<span class="token classname-blue">def</span> <span class="token function">build_report</span>(<span class="token keyword">meta_html</span>, <span class="token keyword">meta_css</span>, <span class="token keyword">meta_js</span>, <span class="token keyword">rss</span>, <span class="token keyword">title</span>, <span class="token keyword">directory</span>):

    pd.<span class="token function">set_option</span>('colheader_justify', 'center')

    <span class="token keyword">html_content</span> = '''
    &#x3C;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
        &#x3C;head>
            &#x3C;meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
            &#x3C;title>{<span class="token classname-blue">show_title</span>}&#x3C;/title>
            &#x3C;link rel="stylesheet" type="text/css" href="assets/style.css"/>
        &#x3C;/head>
        &#x3C;body>
            &#x3C;h1>{<span class="token classname-blue">show_title</span>}&#x3C;/h1>
            {<span class="token classname-blue">table</span>}
        &#x3C;/body>
        &#x3C;script src="assets/script.js">&#x3C;/script>
    &#x3C;/html>
    '''

    <span class="token keyword">css_content</span> = '''

    <span class="token comment"># Custom CSS...</span>

    '''

    <span class="token keyword">js_content</span> = '''

    <span class="token comment"># Custom Javascript...</span>

    '''

    # Create HTML file
    with <span class="token function">open</span>(<span class="token keyword">meta_html</span>, 'w+') as <span class="token keyword-blue">htmlFile</span>:
        <span class="token keyword-blue">htmlFile</span>.<span class="token function">write</span>(<span class="token keyword-blue">html_content</span>.<span class="token function">format</span>(<span class="token keyword-blue">show_title</span>=<span class="token keyword-blue">title</span>, <span class="token keyword-blue">table</span>=<span class="token keyword-blue">rss</span>.<span class="token function">to_html</span>(<span class="token keyword">classes</span>='podracing-style-dark')))

    # Create CSS file
    with <span class="token function">open</span>(<span class="token keyword">meta_css</span>, 'w+') as <span class="token keyword-blue">cssFile</span>:
        <span class="token keyword-blue">cssFile</span>.<span class="token function">write</span>(<span class="token keyword-blue">css_content</span>)

    # Create JS file
    with <span class="token function">open</span>(<span class="token keyword">meta_js</span>, 'w+') as <span class="token keyword-blue">jsFile</span>:
        <span class="token keyword-blue">jsFile</span class="token keyword-blue">.<span class="token function">write</span>(<span class="token keyword-blue">js_content</span>)

    <p></p>
                                        </code></pre>
                                    </p>
                                    <p>
                                        In addition to the main report, smaller text files are created that each contain specific information,
                                        such as a list of all episode names or links to all the audio files for the podcast.
                                    </p>
                                    <p>
                                        Once all the content has been gathered and the metadata files have been created, <strong>podRacer</strong> 
                                        will validate the report and finally merge the three separate files into one.
                                    </p>
                                    <p>
                                        <pre><code class="language-python">
# Custom method that combines the HTML/CSS/JS files into one report within the show's directory
self.<span class="token function">merge_report</span>(<span class="token keyword">meta_html</span>, <span class="token keyword">meta_css</span>, <span class="token keyword">meta_js</span>, <span class="token keyword-blue">title</span>, <span class="token keyword-blue">directory</span>)
                                        </code></pre>
                                    <p><br>
                                        While it is generally advised to keep your HTML, CSS and JS separated 
                                        (see <a href="https://dev.to/tamerlang/separation-of-concerns-the-simple-way-4jp2" target="_blank">separation of concerns</a>),
                                        this convention is overlooked for the sake of having each report be one file instead of three. I could have easily made a PDF out of the whole thing and been done with it, but I like retaining the web formatting (HTML)
                                        to allow users the ability to easily upload and host their own reports and to easily adjust the styling without needing any third-party PDF editors.
                                    </p>
                                    <p>
                                        A built-in theme picker for <strong>podRacer</strong> is currently in development.
                                    </p>
                                </div>
                            </section>
                            
                            <section id="downloads" class="doc-section">
                                <h2 class="section-title">Download Media</h2>
                                <!-- What it does -->
                                <div class="section-block">
                                    <h3 class="block-title">What it does</h3>
                                    <p>Whenever I'm downloading content from the web, I noticed that I always repeat these three actions:</p>
                                    <ul>
                                        <li>I rename the downloaded files to match the name of the content, regardless of what the original filename was</li>
                                        <li>I organize the files within directories so I know exactly where to look to find what I'm looking for</li>
                                        <li>I check if an existing file has been altered/updated and skip downloading it if it hasn't</li>
                                    </ul>
                                    <p>
                                        Naturally, <strong>podRacer</strong> does all of these things for you without the need for any user intervention.
                                    </p>
                                </div>
                                <!-- How it works -->
                                <div class="section-block">
                                    <h3 class="block-title">How it works</h3>
                                    <p>
                                        By using the <a class="scrollto" href="#metadata">metadata</a> from a fetch call, <strong>podRacer</strong> is able
                                        to download media with ease while applying some organizational touches to keep everything neat and tidy.
                                    </p>
                                    <p>
                                        Media links are parsed to check for certain things like domain hosts, SSL certifications, filenames, media types,
                                        and redundancies like redirects and affiliate links. Here's what a media link looks like from the XML data:
                                    </p>
                                    <!-- XML: LINKS -->
                                    <p id="xmllinks">
                                        <pre><code class="language-markup">
&#x3C;enclosure url="https://dts.podtrac.com/redirect.mp3/chrt.fm/track/8DB4DB/pdst.fm/e/nyt.simplecastaudio.com/03d8b493-87fc-4bd1-931f-8a8e9b945d8a/episodes/8f932970-ceda-4af8-83df-b022ed3ad0be/audio/128/default.mp3?aid=rss_feed&awCollectionId=03d8b493-87fc-4bd1-931f-8a8e9b945d8a&awEpisodeId=8f932970-ceda-4af8-83df-b022ed3ad0be&feed=54nAGcIl"/>
                                        </code></pre>
                                    </p>
                                    <p>
                                        <strong>podRacer</strong> automatically amends these links, so it only saves the parts we actually need to retrieve the content.
                                    </p>
                                    <p>
                                        Here's an example of how that works:
                                    </p>
                                    <!-- PYTHON: ORIGINAL LINKS -->
                                    <h5>Python</h5>
                                    <p>
                                        <pre><code class="language-python">
# Amend Download Links
<span class="token classname-blue">def</span> amend_link(self, link):

    # Checks web protocol
    <span class="token keyword">protocol</span> = self.<span class="token function">check_protocol</span>(link) # https://
    
    # Strip protocol from link
    link = link.<span class="token function">split</span>(<span class="token keyword">protocol</span>)[-1]
    
    # Checks for affiliate links
    <span class="token keyword">podtrac</span> = 'dts.podtrac.com/'
    <span class="token keyword">pdst</span> = 'pdst.fm/'
    ...

    # Checks for redirects
    <span class="token keyword">redirect</span> = 'redirect.mp3/'
    ...

    # List of things to remove
    <span class="token keyword">garbage_collector</span> = []
    
    # Find redundancies
    if <span class="token keyword">podtrac</span> in link:
        <span class="token keyword">garbage_collector</span>.<span class="token function">append</span>(<span class="token keyword">podtrac</span>)
    if <span class="token keyword">redirect</span> in link:
        <span class="token keyword">garbage_collector</span>.<span class="token function">append</span>(<span class="token keyword">redirect</span>)
    ...

    # Amend link
    for <span class="token keyword">garbage</span> in <span class="token keyword">garbage_collector</span>:
        link = link.<spanc class="token function">replace</spanc>(<span class="token keyword">garbage</span>, ' ')
    <span class="token keyword">new_link</span> = " ".<span class="token function">join</span>(link.<span class="token function">split</span>())

    # Remove all whitespaces
    <span class="token keyword">new_link</span> = <span class="token keyword">new_link</span>.<span class="token function">strip</span>()

    # Return the link with the proper protocol added
    return f"{<span class="token keyword">protocol</span>}{<span class="token keyword">new_link</span>}"
                                        </code></pre>
                                    </p>
                                    <p>
                                        Here is our updated media link:
                                    </p>
                                    <!-- XML: LINKS AMENDED -->
                                    <p id="xmllinksamended">
                                        <pre><code class="language-markup">
&#x3C;enclosure url="https://nyt.simplecastaudio.com/03d8b493-87fc-4bd1-931f-8a8e9b945d8a/episodes/8f932970-ceda-4af8-83df-b022ed3ad0be/audio/128/default.mp3"/>
                                        </code></pre>
                                        <small><strong>Note: </strong>The file containing the media links includes the full address of each link, but is amended when a download is initiated.
                                            This is so that the download process doesn't have to deal with redirects or invalid inputs. The original links are otherwise saved un-altered within the podcast's directory</small>
                                    </p>
                                    <p>
                                        Next up is checking for the file's audio format
                                    </p>
                                    <!-- PYTHON: AUDIO FORMAT -->
                                    <h5>Python</h5>
                                    <p>
                                        <pre><code class="language-python">
# Detect Audio Format
<span class="token classname-blue">def</span> <span class="token classname">audio_format</span>(self, <span class="token keyword">file</span>):
    self.<span class="token keyword">format</span> = <span class="token keyword">file</span>.<span class="token function">split</span>('.')[-1]
    self.<span class="token keyword">format</span> = re.sub(r"[^a-zA-Z0-9.]+","",self.<span class="token keyword">format</span>)

    # If file requires tokenauth
    if 'tokentime' in self.<span class="token keyword">format</span>:
        self.<span class="token keyword">format</span> = self.<span class="token keyword">format</span>.<span class="token function">split</span>('tokentime')[0]

    return self.<span class="token keyword">format</span>
                                        </code></pre>
                                    </p>
                                    <p>
                                        And finally, we have our filenames to think about. 
                                    </p>
                                    <p>
                                        Currently, our filename is <em>'default.mp3'</em>. If you're just downloading one file
                                        from the web, it's not that much of a burden to have to rename it &mdash; but when downloading hundreds of files
                                        all at once, it would be nice if they weren't all called <em>'default.mp3'</em>, <em>'default(1).mp3'</em>, <em>'default(2).mp3'</em>, etc.
                                    </p>
                                    <p>
                                        Because <strong>podRacer</strong> already has the name of the podcast, the names of all the episodes, the links to all the audio and what
                                        format the audio files are in, it uses this information in its download process to organize your content.
                                    </p>
                                    <!-- PYTHON: BLANK -->
                                    <!-- <h5>Python</h5>
                                    <p>
                                        <pre><code class="language-python">
pass
                                        </code></pre>
                                    </p> -->
                                    <!-- PYTHON: DOWNLOAD Media -->
                                    <h5>Python</h5>
                                    <p>
                                        <pre><code class="language-python">
# Download Media Method
...
self.<span class="token function">download_media</span>(f"{<span class="token keyword">show_dir</span>}/{<span class="token keyword">media_dir</span>}/{<span class="token keyword">title</span>}.{<span class="token keyword">format</span>}", <span class="token keyword">media</span>.<span class="token keyword">content</span>)
                                        </code></pre>
                                    </p>

                                    <!-- <ul class="list list-unstyled">
                                        <li><a href="#" target="_blank"><i class="fas fa-external-link-square-alt"></i> Peity</a></li>
                                        <li><a href="#" target="_blank"><i class="fas fa-external-link-square-alt"></i> Easy Pie Chart</a></li>
                                        <li><a href="#" target="_blank"><i class="fas fa-external-link-square-alt"></i> Sparklines</a></li>
                                    </ul> -->
                                </div>
                            </section>

                            <section id="itunes" class="doc-section">
                                <h2 class="section-title">iTunes API</h2>
                                <!-- What it does -->
                                <div class="section-block">
                                    <h3 class="block-title">What it does</h3>
                                    <p><strong>podRacer</strong> uses the iTunes API to find and organize various content.</p>
                                    <p><strong><i class="fas fa-external-link-square-alt"></i> Source:</strong> <a href="https://developer.apple.com/library/archive/documentation/AudioVideo/Conceptual/iTuneSearchAPI" target="_blank">https://developer.apple.com/</a></p>
                                    <p>
                                        This integration allows you to search for various Apple hosted content and gives <strong>podRacer</strong> the ability to collect 
                                        certain metadata from podcasts.
                                    </p>
                                </div>
                                <!-- How it works -->
                                <div class="section-block">
                                    <h3 class="block-title">How it works</h3>
                                    <p>
                                        A request is sent to the iTunes API using the following URL qualification
                                    </p>
                                    <!-- JS: ITUNES API URL -->
                                    <p id="itunesapiurl">
                                        <pre><code class="language-markup">
<span class="token attr-value">https://itunes.apple.com/search?parameterkeyvalue</span>
                                        </code></pre>
                                    </p>
                                    <p>
                                        Here is a list of valid parameters to use this API:
                                    </p><br>
                                    <!-- ITUNES API TABLE -->
                                    <div>
  
                                        <table cellspacing="0" cellpadding="5">
                                          <thead>
                                              <tr>
                                                  <th>
                                        Key
                                      </p></th>
                                                  <th>
                                        Description
                                      </p></th>
                                                  <th>
                                        Values
                                      </p></th>
                                              </tr>
                                          </thead>
                                          <tbody>
                                              <tr>
                                                  <td>
                                        term
                                      </p></td>
                                                  <td><p>
                                        The URL-encoded text string you want to search for. For example: jack+johnson.
                                      </p></td>
                                                  
                                                  <td><p>
                                        Any URL-encoded text string.
                                      </p><p>
                                        <strong>Note</strong>: URL encoding replaces spaces with the plus (+) character and all characters except the following are encoded: letters, numbers, periods (.), dashes (-), underscores (_), and asterisks (*).
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        country
                                      </p></td>
                                                  <td><p>
                                        The two-letter country code for the store you want to search. The search uses the default store front for the specified country. For example: US. The default is US.
                                      </p></td>
                                                  
                                                  <td><p>
                                        See <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="_blank">ISO_3166-1_alpha-2</a> for a list of ISO Country Codes.
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        media
                                      </p></td>
                                                  <td><p>
                                        The media type you want to search for. For example: movie. The default is all.
                                      </p></td>
                                                  
                                                  <td><p>
                                        movie, podcast, music, musicVideo, audiobook, shortFilm, tvShow, software, ebook, all
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        entity
                                      </p></td>
                                                  <td><p>
                                        The type of results you want returned, relative to the specified media type. For example: movieArtist for a movie media type search. The default is the track entity associated with the specified media type.
                                      </p></td>
                                                  
                                                  <td><p>
                                        podcastAuthor, podcast
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        attribute
                                      </p></td>
                                                  <td><p>
                                        The attribute you want to search for in the stores, relative to the specified media type. For example, if you want to search for an artist by name specify <code class="code-voice">entity=allArtist&amp;attribute=allArtistTerm</code>. 
                                      </p></td>
                                                  
                                                  <td><p>
                                        titleTerm, languageTerm, authorTerm, genreIndex, artistTerm, ratingIndex, keywordsTerm, descriptionTerm
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        callback
                                      </p></td>
                                                  <td><p>
                                        The name of the Javascript callback function you want to use when returning search results to your website.
                                      </p></td>
                                                  <td><p>
                                        wsSearchCB
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        limit
                                      </p></td>
                                                  <td><p>
                                        The number of search results you want the iTunes Store to return. For example: 25. The default is 50.
                                      </p></td>
                                                  
                                                  <td><p>
                                        1 to 200
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        lang
                                      </p></td>
                                                  <td><p>
                                        The language, English or Japanese, you want to use when returning search results. Specify the language using the five-letter codename. For example: en_us. The default is en_us (English).
                                      </p></td>
                                                  
                                                  <td><p>
                                        en_us, ja_jp
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        version
                                      </p></td>
                                                  <td><p>
                                        The search result key version you want to receive back from your search. The default is 2.
                                      </p></td>
                                                  
                                                  <td><p>
                                        1,2
                                      </p></td>
                                              </tr>
                                              <tr>
                                                  <td>
                                        explicit
                                      </p></td>
                                                  <td><p>
                                        A flag indicating whether or not you want to include explicit content in your search results. The default is Yes.
                                      </p></td>
                                                  
                                                  <td><p>
                                        Yes, No
                                      </p></td>
                                              </tr>
                                          </tbody>
                                        </table>
                                    </div>
                                    <hr>
                                    <p>
                                        The Search API returns your search results in JavaScript Object Notation (JSON) format. JSON is built on two structures:
                                    </p>
                                    <ul>
                                        <li>
                                            A collection of name/value pairs, also known as an object; this concept is similar to a Java Map object, a Javascript Dictionary, 
                                            or a Pearl/Ruby hash. An object is an unordered set of name/value pairs, beginning with a left brace ( { ) and ending with a right brace ( } ). 
                                            Each name is surrounded by double-quotes and followed by a colon ( : ); the name/value pairs are separated by commas ( , ).
                                        </li>
                                        <br>
                                        <li>
                                            An ordered list of values, also known as an array. An array is an ordered collection of values, beginning with a left bracket 
                                            ( [ ) and ending with a right bracket ( ] ). Values are separated by commas ( , ).
                                        </li>
                                    </ul>
                                    <p>
                                        The following example displays the JSON results for a song in the iTunes Store (encoded in UTF8):
                                    </p>
                                    <!-- JSON: ITUNES API -->
                                    <h5>JSON</h5>
                                    <p>
                                        <pre><code class="language-javascript">
{"wrapperType":"track",
    "kind":"song",
    "artistId":909253,
    "collectionId":120954021,
    "trackId":120954025,
    "artistName":"Jack Johnson",
    "collectionName":"Sing-a-Longs and Lullabies for the Film Curious George",
    "trackName":"Upside Down",
    "collectionCensoredName":"Sing-a-Longs and Lullabies for the Film Curious George",
    "trackCensoredName":"Upside Down",
    "artistViewUrl":"https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewArtist?id=909253",
    "collectionViewUrl":"https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewAlbum?i=120954025&id=120954021&s=143441",
    "trackViewUrl":"https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewAlbum?i=120954025&id=120954021&s=143441",
    "previewUrl":"http://a1099.itunes.apple.com/r10/Music/f9/54/43/mzi.gqvqlvcq.aac.p.m4p",
    "artworkUrl60":"http://a1.itunes.apple.com/r10/Music/3b/6a/33/mzi.qzdqwsel.60x60-50.jpg",
    "artworkUrl100":"http://a1.itunes.apple.com/r10/Music/3b/6a/33/mzi.qzdqwsel.100x100-75.jpg",
    "collectionPrice":10.99,
    "trackPrice":0.99,
    "collectionExplicitness":"notExplicit",
    "trackExplicitness":"notExplicit",
    "discCount":1,
    "discNumber":1,
    "trackCount":14,
    "trackNumber":1,
    "trackTimeMillis":210743,
    "country":"USA",
    "currency":"USD",
    "primaryGenreName":"Rock"}
                                        </code></pre>
                                    </p>
                                    <p>
                                        Using this information, <strong>podRacer</strong> is able to gather certain information, such as
                                        authors, availability, genre, artwork, etc. 
                                    </p>
                                </div>
                            </section>

                            <section id="search" class="doc-section">
                                <h2 class="section-title">Search Engine</h2>
                                <!-- What it does -->
                                <div class="section-block">
                                    <h3 class="block-title">What it does</h3>
                                    <p>
                                        <strong>podRacer</strong> has a built&ndash;in search engine that uses the iTunes API
                                        to find podcasts using various search parameters. Running a search automatically executes a fetch
                                        call on the resulting podcast.
                                    </p>
                                </div>
                                <!-- How it works -->
                                <div class="section-block">
                                    <h3 class="block-title">How it works</h3>
                                    <p>
                                        When a new search is conducted, the tool first searches for any matching titles and automatically runs a fetch call
                                        on the most likely result. If a matching title cannot be found, it passes the search parameter to the next query and 
                                        searches for matching authors (artistName) instead.
                                    </p>
                                    <p>
                                        Here's an example of how this works:
                                    </p>
                                    <!-- PYTHON: ITUNES API SEARCH -->
                                    <p id="itunesapiurl">
                                        <pre><code class="language-python">
<span class="token classname-blue">def</span> itunes_api(<span class="token keyword">search</span>, <span class="token keyword">country</span>, <span class="token keyword">type</span>):                                  
    <span class="token keyword">search_request</span> = requests.<span class="token function">get</span>("https://itunes.apple.com/search", <span class="token keyword">params</span>={
        'term': <span class="token keyword">search</span>,       # Radiolab
        'country': <span class="token keyword">country</span>,   # 'us'
        'entity': <span class="token keyword">type</span>,       # 'podcast'
        ...
    }

    return <span class="token keyword">search_request</span>.<span class="token function">json</span>()

<span class="token classname-blue">def</span> search_itunes(self, <span class="token keyword">search</span>):

    # Results from iTunes
    <span class="token keyword">search_result</span> = <span class="token classname">PodSearch</span>.<span class="token function">itunes_api</span>('Radiolab', 'us', 'podcast')
    ...

    # RSS Feed URL from our search
    <span class="token keyword">result_rss</span> = result['results'][0]['feedUrl']
    
    # Run fetch call on RSS feed
    <span class="token classname">podRacer</span>.<span class="token function">fetch_RSS</span>(<span class="token keyword">result_rss</span>)
                                        </code></pre>
                                    </p>
                                    <p>
                                        This is also applies for the 'Find Podcast' tool, which searches for content on Apple Podcast and
                                        opens the resulting show in the native MacOS Podcasts app. 
                                    </p>
                                </div>
                            </section>

                            <section class="doc-section">
                                <div class="section-block">
                                    <h2 class="block-title">Wrap-Up</h2>
                                    <p>
                                        That covers the three core functions of <strong>podRacer</strong>, but there's a lot of additional
                                        functionality that we have not covered yet, such as bookmarks, importing/exporting data,
                                        Patreon integration, cross-referencing hosted content and more. I will update this page over time
                                        with more features as the application develops.
                                    </p>
                                </div>
                                <!-- Jumbotron -->
                                <div class="section-block">
                                    <div class="jumbotron text-center">
                                        <p class="speech-bubble">
                                            Download <strong>podRacer</strong> and try its features out for yourself! If you have any questions
                                            about how it works, feel free to <a href="mailto:contact@mafshari.work?subject=RE%3A%20Software%20Engineer%20Needed!&body=Hi%20Mike%2C%0D%0A%0D%0AyourMessage%0D%0A%0D%0ASincerely%2C%0D%0AyourName" target="_blank">contact me</a> or checkout the <a href="support.html">support</a> page.  
                                        </p>
                                        <ul class="list list-inline center-block">
                                            <li class="list-inline-item"><a class="btn btn-cta btn-primary" href="https://www.podracer.app/get/podRacer_installer.zip" download><i class="fas fa-download"></i> Download</a></li>
                                            <li class="list-inline-item"><a class="btn btn-cta btn-green" href="start.html" target="_blank"><i class="icon fa fa-paper-plane"></i> Start Guide</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </section>

                        </div>

                    </div>

                    <div class="doc-sidebar col-md-3 col-12 order-0 d-none d-md-flex">
                        <div id="doc-nav" class="doc-nav">
                            <nav id="doc-menu" class="nav doc-menu flex-column sticky">
                                <span class="nav underline"></span>
                                <a class="nav-link scrollto" href="#foundation">Foundation</a>
                                <span class="nav underline"></span>
                                <a class="nav-link scrollto" href="#fetch-calls">File System</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#button-download">File Manager</a>
                                    <ol>
                                        <a class="nav-link scrollto" href="#button-metadata">Copy</a>
                                        <a class="nav-link scrollto" href="#button-find">Formats</a>
                                        <a class="nav-link scrollto" href="#button-metadata">Remove</a>
                                        <a class="nav-link scrollto" href="#button-metadata">Rename</a>
                                    </ol>
                                    <a class="nav-link scrollto" href="#button-savedir">Mail Composer</a>
                                    <a class="nav-link scrollto" href="#button-metadata">Path Finder</a>
                                    <ol>
                                        <a class="nav-link scrollto" href="#button-metadata">Path Exists</a>
                                        <a class="nav-link scrollto" href="#button-metadata">Path Root</a>
                                    </ol>
                                    <a class="nav-link scrollto" href="#button-metadata">System</a>
                                    <ol>
                                        <a class="nav-link scrollto" href="#button-metadata">Application Manager</a>
                                        <a class="nav-link scrollto" href="#button-metadata">System Information</a>
                                        <a class="nav-link scrollto" href="#button-metadata">Validation Tools</a>
                                    </ol>
                                </nav>
                                <a class="nav-link scrollto" href="#metadata">Strings</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#button-savedir">Filter</a>
                                    <a class="nav-link scrollto" href="#button-savedir">Find</a>
                                    <a class="nav-link scrollto" href="#button-download">Format</a>
                                    <a class="nav-link scrollto" href="#button-savedir">Replace</a>
                                    <a class="nav-link scrollto" href="#button-metadata">Shorten</a>
                                </nav>
                                <a class="nav-link scrollto" href="#downloads">Terminal</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#button-savedir">Clear</a>
                                    <a class="nav-link scrollto" href="#button-savedir">List</a>
                                    <a class="nav-link scrollto" href="#button-download">Pause</a>
                                    <a class="nav-link scrollto" href="#button-savedir">Restart</a>
                                    <a class="nav-link scrollto" href="#button-metadata">Wait</a>
                                </nav>
                                <a class="nav-link scrollto" href="#itunes">Web Tools</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#button-savedir">Build / Merge</a>
                                    <a class="nav-link scrollto" href="#button-download">Download</a>
                                    <a class="nav-link scrollto" href="#button-savedir">Network Test</a>
                                    <a class="nav-link scrollto" href="#button-metadata">Read Format</a>
                                    <a class="nav-link scrollto" href="#button-metadata">Strip Tags</a>
                                </nav>
                                <span class="nav underline"></span>
                                <a id="nav-scrollup" class="nav-link scrollto" href="#header">Scroll to the top</a>
                            </nav>
                        </div>
                    </div>

                </div>

            </div>
        </div>
        
    </div>


    <footer id="footer" class="footer text-center">
        <div class="container">
            <small class="copyright">podRacer developed by <a href="https://mafshari.work" target="_blank">Mike Afshari</a></small>
        </div>
    </footer>
    
     
    <!-- Main Javascript -->          
    <script type="text/javascript" src="assets/plugins/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/plugins/prism/prism.js"></script>    
    <script type="text/javascript" src="assets/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>  
    <script type="text/javascript" src="assets/plugins/lightbox/dist/ekko-lightbox.min.js"></script>       
    <script type="text/javascript" src="assets/plugins/stickyfill/dist/stickyfill.min.js"></script>                                                            
    <script type="text/javascript" src="assets/js/main.js"></script>
    
</body>

</html> 

